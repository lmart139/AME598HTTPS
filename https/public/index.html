<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EpiCare - Epilepsy Support Chatbot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #030303 0%, #4f3f5f 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 600px;
            background: rgb(80, 80, 80);
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            height: 90vh;
            max-height: 800px;
        }

        .header {
            background: linear-gradient(135deg,  #030303 0%, #4f3f5f  100%);
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #464646;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-bubble {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 12px;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .message.user .message-bubble {
            background: #667eea;
            color: #333;
            border-bottom-right-radius: 4px;
        }

        .message.bot .message-bubble {
            background: #333;
            color:  #e8e8e8;
            border-bottom-left-radius: 4px;
        }

        .input-area {
            padding: 20px;
            border-top: 1px solid #ddd;
            background: #333;
            border-radius: 0 0 15px 15px;
            display: flex;
            gap: 10px;
        }

        input[type="text"] {
            flex: 1;
            border: 2px solid #ddd;
            border-radius: 25px;
            padding: 12px 20px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
            font-weight: bold;
        }

        button:hover {
            transform: scale(1.05);
        }

        button:active {
            transform: scale(0.95);
        }

        .quick-prompts {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .quick-prompt {
            color: white;
            background: #333;
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .quick-prompt:hover {
            background: #667eea;
            color: white;
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #667eea;
            animation: bounce 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes bounce {
            0%, 80%, 100% {
                opacity: 0.5;
                transform: translateY(0);
            }
            40% {
                opacity: 1;
                transform: translateY(-10px);
            }
        }

        .disclaimer {
            font-size: 12px;
            color: #999;
            text-align: center;
            padding: 10px;
            border-top: 1px solid #eee;
        }

        .settings-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-content h2 {
            margin-bottom: 20px;
            color: #667eea;
        }

        .modal-content label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .modal-content input {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .modal-content button {
            width: 100%;
            margin-top: 10px;
        }

        .close-modal {
            float: right;
            font-size: 28px;
            font-weight: bold;
            color: #999;
            cursor: pointer;
        }

        .close-modal:hover {
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† CalmMind</h1>
            <p>Your Supportive Companion for Epilepsy Stress Management</p>
        </div>

        <div class="chat-area" id="chatArea">
            <div class="message bot">
                <div class="message-bubble">
                    Hello! I'm CalmMind, your supportive companion powered by AI. üíô I'm here to help you manage stress related to epilepsy. Whether you're dealing with seizure anxiety, daily challenges, or just need someone to talk to, I'm here for you. What's on your mind today?
                </div>
            </div>
        </div>

            
        <div style="padding: 15px 20px; background: #464646;">
            <div class="quick-prompts" id="quickPrompts">
                <button class="quick-prompt" onclick="sendQuickMessage('I\'m feeling anxious about my next seizure')">Seizure Anxiety</button>
                <button class="quick-prompt" onclick="sendQuickMessage('How can I manage stress?')">Stress Management</button>
                <button class="quick-prompt" onclick="sendQuickMessage('I need coping strategies')">Coping Strategies</button>
                <button class="quick-prompt" onclick="sendQuickMessage('Tell me about seizure triggers')">Seizure Triggers</button>
            </div>
        </div>

        <div class="input-area">
            <input type="text" id="userInput" placeholder="Type your message here..." autocomplete="off">
            <button onclick="sendMessage()">Send</button>
        </div>

        <div class="disclaimer">
            üí° This chatbot provides supportive guidance powered by AI. Always consult with your healthcare provider for medical advice.
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeSettings()">&times;</span>
            <h2>API Settings</h2>
            <label for="apiToken">Hugging Face API Token:</label>
            <input type="password" id="apiToken" placeholder="Your Hugging Face API token" value="">
            <p style="font-size: 12px; color: #666; margin-bottom: 15px;">
                Get your free token at <a href="https://huggingface.co/settings/tokens" target="_blank">huggingface.co/settings/tokens</a>
            </p>
            <button onclick="saveSettings()">Save Settings</button>
            <button onclick="closeSettings()" style="background: #999; margin-top: 5px;">Cancel</button>
        </div>
    </div>

    <button class="settings-btn" onclick="openSettings()" title="API Settings">‚öôÔ∏è</button>

    <script>
        const chatArea = document.getElementById('chatArea');
        const userInput = document.getElementById('userInput');
        const quickPrompts = document.getElementById('quickPrompts');

        let apiToken = localStorage.getItem('hf_api_token') || '';

        function openSettings() {
            document.getElementById('settingsModal').style.display = 'block';
            document.getElementById('apiToken').value = apiToken;
        }

        function closeSettings() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        function saveSettings() {
            const token = document.getElementById('apiToken').value.trim();
            if (!token) {
                alert('Please enter a valid API token');
                return;
            }
            apiToken = token;
            localStorage.setItem('hf_api_token', token);
            closeSettings();
            alert('Settings saved! Your API token is stored locally.');
        }

        window.onclick = function(event) {
            const modal = document.getElementById('settingsModal');
            if (event.target === modal) {
                closeSettings();
            }
        }

        async function generateResponse(userMessage) {
            if (!apiToken) {
                return "Please set your Hugging Face API token first. Click the ‚öôÔ∏è button in the top right.";
            }

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: userMessage,
                        token: apiToken
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    return errorData.error || "Error connecting to AI. Please try again.";
                }

                const data = await response.json();
                return data.response || "I'm having trouble generating a response. Please try again.";
            } catch (error) {
                console.error('Error:', error);
                return "Connection error. Please check your internet and try again.";
            }
        }

        function addMessage(text, isUser) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            
            const bubble = document.createElement('div');
            bubble.className = 'message-bubble';
            bubble.textContent = text;
            
            messageDiv.appendChild(bubble);
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function showTypingIndicator() {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            messageDiv.id = 'typingIndicator';
            
            const bubble = document.createElement('div');
            bubble.className = 'message-bubble';
            bubble.innerHTML = '<div class="typing-indicator"><span></span><span></span><span></span></div>';
            
            messageDiv.appendChild(bubble);
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) indicator.remove();
        }

        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;

            addMessage(message, true);
            userInput.value = '';

            // Show typing indicator
            showTypingIndicator();

            // Get AI response
            const response = await generateResponse(message);
            removeTypingIndicator();
            addMessage(response, false);
        }

        function sendQuickMessage(message) {
            userInput.value = message;
            sendMessage();
            quickPrompts.style.display = 'none';
        }

        // Send message on Enter key
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        // Focus input on load
        window.addEventListener('load', () => {
            if (!apiToken) {
                setTimeout(() => {
                    alert('Welcome to EpiCare! Please set your Hugging Face API token to enable AI responses. Click the ‚öôÔ∏è button.');
                    openSettings();
                }, 500);
            }
            userInput.focus();
        });
    </script>
</body>
</html>
